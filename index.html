<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Biblioteca Online</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .livro { display: inline-block; width: 150px; margin: 15px; position: relative; }
    .livro img { width: 100%; border-radius: 8px; }
    .livro h2 { font-size: 16px; margin: 8px 0; }
    .livro-views { 
      position: absolute; 
      top: 8px; right: 8px; 
      display: flex; 
      align-items: center; 
      font-size: 14px; 
      background: rgba(0,0,0,0.5); 
      color: white; 
      padding: 2px 6px; 
      border-radius: 12px; 
    }
    .livro-views svg { width: 16px; height: 16px; margin-right: 4px; }
    .botao { display: block; margin-top: 8px; background: #673ab7; color: white; text-align: center; padding: 6px; border-radius: 6px; text-decoration: none; }
    footer { text-align: center; padding: 20px; background: #f4f4f4; }
    footer span { font-weight: bold; }

    /* Painel admin */
    #adminPanel {
      display: none; 
      position: fixed; 
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); 
      color: white; 
      padding: 20px; 
      overflow: auto; 
      z-index: 9999;
    }
    #adminPanel h2 { color: #bb86fc; }
    .admin-book { margin: 10px 0; }
    .admin-book button, #resetTotal, #closeAdmin {
      margin: 5px; padding: 6px 12px; 
      border: none; border-radius: 6px; 
      cursor: pointer;
      background: #673ab7; color: white;
    }
    #closeAdmin { background: crimson; }

    /* Responsivo */
    @media (max-width: 600px) {
      .livro { width: 120px; }
      .livro-views { font-size: 12px; padding: 2px 4px; }
      .livro-views svg { width: 14px; height: 14px; }
    }
  </style>
</head>
<body>

  <h1 style="text-align:center;">Minha Biblioteca</h1>

  <!-- Livros -->
  <div class="livro" data-book="livro1">
    <img src="https://placehold.co/150x220" alt="Livro 1">
    <div class="livro-views">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
      <span>0</span>
    </div>
    <h2>Livro 1</h2>
    <a href="#" class="botao">Ver detalhes</a>
  </div>

  <div class="livro" data-book="livro2">
    <img src="https://placehold.co/150x220" alt="Livro 2">
    <div class="livro-views">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
      <span>0</span>
    </div>
    <h2>Livro 2</h2>
    <a href="#" class="botao">Ver detalhes</a>
  </div>

  <footer>
    Total de visitas: <span id="totalVisits">0</span>
  </footer>

  <!-- Painel admin -->
  <div id="adminPanel">
    <button id="closeAdmin">Fechar</button>
    <h2>PAINEL ADMIN</h2>
    <div id="adminBooks"></div>
    <button id="resetTotal">Zerar Total</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <script>
    // Config Firebase
    const firebaseConfig = {
      apiKey: "SUA-API-KEY",
      authDomain: "SEU-PROJETO.firebaseapp.com",
      databaseURL: "https://SEU-PROJETO.firebaseio.com",
      projectId: "SEU-PROJETO",
      storageBucket: "SEU-PROJETO.appspot.com",
      messagingSenderId: "0000000000",
      appId: "1:0000000000:web:xxxxxxxx"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // UID do admin
    const ADMIN_UID = "RHb8vZeeb0RfTRhR1fpzO0ICFq53";

    // Total de visitas
    const totalVisitsEl = document.getElementById('totalVisits');
    const totalRef = db.ref('totalVisits');
    totalRef.once('value', snap=>{ if(snap.val()===null) totalRef.set(0); });
    totalRef.on('value', snap=>{ totalVisitsEl.innerText = snap.val()||0; });

    if(!sessionStorage.getItem("visited")){
      totalRef.transaction(current=>(current||0)+1);
      sessionStorage.setItem("visited","true");
    }

    // Livros
    const livros = document.querySelectorAll('.livro');
    livros.forEach(livro=>{
      const key = livro.dataset.book;
      const ref = db.ref('books/'+key+'/views');
      ref.once('value', snap=>{ if(snap.val()===null) ref.set(0); });
      const span = livro.querySelector('.livro-views span');
      ref.on('value', snap=>{ span.innerText = snap.val()||0; });

      const link = livro.querySelector('.botao');
      link.addEventListener('click', ()=>{
        ref.transaction(current=>(current||0)+1);
        totalRef.transaction(current=>(current||0)+1);
      });
    });

    // Painel Admin
    let adminPanel = document.getElementById('adminPanel');
    document.getElementById('closeAdmin').addEventListener('click', ()=>{ adminPanel.style.display='none'; });

    document.addEventListener('keydown', e=>{
      if(e.altKey && e.shiftKey && e.key.toLowerCase()=='a'){
        if(!auth.currentUser){
          const email = prompt('Digite seu e-mail de admin:');
          const password = prompt('Digite sua senha de admin:');
          auth.signInWithEmailAndPassword(email,password)
            .then(user=>{
              if(user.user.uid === ADMIN_UID){
                adminPanel.style.display='block'; 
                loadAdminPanel();
              } else {
                alert('Você não é admin autorizado.');
                auth.signOut();
              }
            })
            .catch(()=>alert('E-mail ou senha incorretos'));
        } else {
          if(auth.currentUser.uid === ADMIN_UID){
            adminPanel.style.display='block';
            loadAdminPanel();
          } else {
            alert('Conta logada não é admin.');
            auth.signOut();
          }
        }
      }
    });

    function loadAdminPanel(){
      const adminBooks = document.getElementById('adminBooks');
      adminBooks.innerHTML='';
      livros.forEach(livro=>{
        const key = livro.dataset.book;
        const ref = db.ref('books/'+key+'/views');
        const div = document.createElement('div');
        div.className='admin-book';
        div.innerHTML=`
          <span>${livro.querySelector('h2').innerText}: <span id="count-${key}">0</span></span>
          <button id="inc-${key}">+</button>
          <button id="dec-${key}">-</button>
          <button id="reset-${key}">Zerar</button>
        `;
        adminBooks.appendChild(div);
        ref.on('value', snap=>{ div.querySelector('#count-'+key).innerText = snap.val()||0; });
        div.querySelector('#inc-'+key).addEventListener('click', ()=>{ ref.transaction(c=>(c||0)+1); });
        div.querySelector('#dec-'+key).addEventListener('click', ()=>{ ref.transaction(c=>(c||0)-1); });
        div.querySelector('#reset-'+key).addEventListener('click', ()=>{ ref.set(0); });
      });
      document.getElementById('resetTotal').onclick = ()=>{ totalRef.set(0); };
    }
  </script>
</body>
</html>
